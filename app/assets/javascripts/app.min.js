var drip8=angular.module("Drip8",["angular-flexslider","infinite-scroll"]);drip8.directive("auth",[function(){return{restrict:"A",scope:!0,link:function(i,e,t){i.login=function(){window.location="/auth/facebook"}}}}]),drip8.directive("bucket",["$rootScope","$http","profileService","dripListService",function(i,e,t,r){return{restrict:"A",scope:!0,link:function(o,n,c){o.profileData={},o.buckets=[],o.newDrip=function(e,t){i.$broadcast("drip-new",e,t)},o.getDrip=function(i){e.post("/api/read_drips_by_bucket_and_user",{user_id:o.profileData.id,dripbucket_id:i}).success(function(i){})},o.description=function(i){return null!=i},o.newBucket=function(i){$("#createDripBoardBox").modal("hide"),e.post("/api/add_bucket",{bucket:{user_id:o.profileData.id,name:i.name,state:i.state}}).success(function(i){window.location.reload()})},o.getAllBucket=function(){e.post("/api/read_all_bucket_by_user",{user_id:o.profileData.id}).success(function(i){o.buckets=i.buckets;var e=t.setProfile();"1"==e.id&&"1"==o.profileData.id&&o.buckets.splice(0,3)})},o.rename=function(i,e){};var s=function(i,t){var r=[];return i.forEach(function(i){t="public"==t?i.state:"profile only",r.push(function(r){e.post("/api/update_drip_state",{drip_id:i.id,state:t}).success(function(i){r(null,i)})})}),r};o.setting=function d(i,d,t,n){switch(t){case"drip":e.post("/api/update_drip_state",{drip_id:i.id,state:d}).success(function(i){o.$broadcast("drips-reload")});break;case"bucket":var c=r.setDripList(),a=c[n],p=s(a,d);async.parallel(p,function(i,e){o.$broadcast("drips-reload")})}},o.deleteDrip=function(i,e){},o.settingDropdown=function(i){var e=t.setProfile();if(o.profileData.id!=e.id)return!1;switch(i){case"who I am":return!1;case"what I do":return!1;case"what I am proud of":return!1;default:return!0}},o.$on("profile-data",function(i,e){o.profileData=JSON.parse(localStorage.userProfile),o.getAllBucket()})}}}]),drip8.directive("ifBucket",["$http",function(i){return{restrict:"A",scope:!0,link:function(i,e,t){console.log(i.$parent.bucketName)}}}]),drip8.directive("dripDashboard",["$http","$rootScope",function(i,e){return{restrict:"A",scope:!0,link:function(t,r,o){function n(e,r,o){i.post("/api/drip_each",{drip_id:e}).success(function(i){return i.drip.state!=t.category&&n(e-1,r),null!=i.drip&&i.drip.state==t.category&&r.push(i),0==o&&(t.lastId="stop"),i})}function c(r,o,n){i.post("/api/drip_each",{drip_id:r}).success(function(i){console.log(i),i.drip.state!=t.category&&(console.log("dili parehas",r-1),console.log("dili parehas",o),c(r-1,o)),null!=i.drip&&i.drip.state==t.category&&(o.push(i.drip.id),console.log("parehas mi YEAH"),console.log("pushed",i.drip.id),o.length<3?c(r-1,o):e.$broadcast("async-yeah",o)),0==n&&(t.lastId="stop")})}t.drips=[],t.ready=!1,t.category=localStorage.getItem("category")||"public",t.lastId="dont stop",t.asyncTasksArray=[];e.$on("async-yeah",function(i,e){console.log(e),console.log("asynctasks",t.asyncTasksArray);var r=s(e);async.parallel(r,function(i,e){for(var r=0;r<e.length;r++)(null==e[r].drip||e[r].drip.state!=t.category)&&(console.log("***************************deleted",e[r].drip),e.splice(r,1));t.drips=e})}),e.$on("on-length-finish",function(i,e){t.index=e,t.drip_length=e,console.log(e),c(t.index,t.asyncTasksArray),console.log("ASYNC GAGO",t.asyncTasksArray)}),i.get("/api/drip_length").success(function(i){e.$broadcast("on-length-finish",i.count)}),t.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))},t.fbShare=function(i){FB.ui({method:"share",href:i,caption:"www.drip8.com"},function(i){})};var s=function(e){var t=[];return e.forEach(function(e){t.push(function(t){i.post("/api/drip_each",{drip_id:e}).success(function(i){t(null,i)})})}),t};t.seeBucket=function(i){e.$broadcast("see-bucket",i)},t.loadMore=function(){var e=t.drips[t.drips.length-1];if(null!=e){var r=e.drip.id,o=r-1;r>=0&&"stop"!=t.lastId&&i.post("/api/drip_each",{drip_id:o}).success(function(i){i.drip.state!=t.category&&n(i.drip.id-1,t.drips,r),null!=i.drip&&i.drip.state==t.category&&t.drips.push(i),0==r&&(t.lastId="stop")})}}}}}]),drip8.service("dripListService",[function(){var i=[];return{setDripList:function(e,t){return t?void(i[e]=t):i}}}]),drip8.directive("dripList",["$http","Video","$rootScope","dripListService",function(i,e,t,r){return{restrict:"A",scope:!0,link:function(o,n,c){var s=c.dripList.split("-");o.drips=[];var d=function(i){var e=[];return i.forEach(function(i){"deleted"!=i.state&&e.push(i)}),e};o.dripListing=function(){i.post("/api/read_drips_by_bucket_and_user",{dripbucket_id:s[0],user_id:s[1]}).success(function(i){o.drips=i.drips,r.setDripList(s[2],o.drips),o.drips=d(o.drips),$("#welcome").modal("hide")})},o.linkUri=function(i,t){var r=i.split("v=")[1],o=r.indexOf("&");return-1!=o&&(r=r.substring(0,o)),"thumb"==t?e.thumbnail(r):e.videoSource(r)},o.showVideo=function(i,e){$("#videoLink").modal("show"),t.$broadcast("video-source",i,e)},o.dripListing(),o.$on("drips-reload",function(){o.dripListing()})}}}]),drip8.directive("dripModalBucket",["$http","$rootScope","Video","profileService",function(i,e,t,r){return{restrict:"A",scope:!0,link:function(o,n,c){e.$on("see-bucket",function(i,e){o.directDrip=t.videoSource(e.drip.link.split("v=")[1]),o.dripBucketDetails=e,o.comments=o.dripBucketDetails.drip.comments;for(var r=0;r<=e.drip.dripbucket.drips.length-1;r++){var n=o.dripBucketDetails.drip.dripbucket.drips[r].link.split("v=")[1];o.dripBucketDetails.drip.dripbucket.drips[r].thumb=t.thumbnail(n)}o.drip=o.dripBucketDetails.drip}),o.exit=function(){$("#myModal").modal("hide")},o.fbShare=function(i){FB.ui({method:"share",href:i,caption:"www.drip8.com"},function(i){})},o.changeVideo=function(i){o.$broadcast("change-video",i)},o.$on("change-video",function(i,e){o.directDrip=t.videoSource(e.link.split("v=")[1]),o.comments=e.comments,o.drip=e}),o.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))},o.react=function(e){var t=r.setProfile(),n=t.profile_picture.split("/")[3];i.post("/api/create_comment",{comment:{user_id:t.id,drip_id:o.drip.id,dripbucket_id:"",facebook_id:n,body:e}}).success(function(i){var e=i.comment;e.user=t,o.comments.push(e)}),o.dripComment=""}}}}]),drip8.directive("drip",["$http","$rootScope",function(i,e){return{restrict:"A",scope:!0,link:function(t,r,o){t.dripDetails={state:"profile only"},t.profileData={},t.addDrip=function(){$("#addADrip").modal("hide"),t.dripDetails.user_id=t.profileData.id;var r=t.dripDetails.link.slice(0,5);if("https"==r){var o=t.dripDetails.link.replace("https","http");t.dripDetails.link=o}i.post("/api/add_drip",{drip:t.dripDetails}).success(function(i){e.$broadcast("drips-reload"),t.dripDetails={state:"public"}})},t.dripState=function(){return"who I am"==t.bucketName||"what I do"==t.bucketName||"what I am proud of"==t.bucketName?!1:!0},t.$on("drip-new",function(i,e,r){t.dripDetails.dripbucket_id=e,t.bucketName=r,t.dripState=function(){return"who I am"==t.bucketName||"what I do"==t.bucketName||"what I am proud of"==t.bucketName?!1:!0}}),t.$on("profile-data",function(i,e){t.profileData=e})}}}]),drip8.directive("feature",["$http",function(i){return{restrict:"A",scope:!0,link:function(e,t,r){var o=r.feature.split("-");t.bind("click",function(){i.post("/api/new_featured",{user_id:o[0],drip_id:o[1]}).success(function(i){window.location.reload()})})}}}]),drip8.service("profileService",[function(){var i={};return{setProfile:function(e){return e?void(i=e):i}}}]),drip8.directive("profile",["$http","Video","$rootScope","profileService",function(i,e,t,r){return{restrict:"A",scope:!0,compile:function(o,n){return{pre:function(i,e,t){i.count=0,i.profileName=function(e){if(void 0!=e&&(i.count+=1,1==i.count)){var e=e.split(" ");return e[0]}}},post:function(o,n,c){o.setCategory=function(i){localStorage.setItem("category",i),console.log(i)},o.logout=function(){var i=new Date;i.setMonth(i.getMonth()-1),cookievalue=escape(document.myform.customer.value)+";",document.cookie="_Drip8_session="+cookievalue,document.cookie="expires="+i.toUTCString()+";"},$("#welcomeHere").modal("show"),o.profile={},o.getUserInfo=function(){i.get("/api/user").success(function(i){o.profile=i.data,o.trustUrl()})},o.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))},o.trustUrl=function(){var r="";i.post("/api/video_featured",{user_id:o.profile.id}).success(function(i){if(i.link){r=i.link.split("v=")[1];var n=r.indexOf("&");-1!=n&&(r=r.substring(0,n))}o.profile.featured=i.link,t.$broadcast("profile-data",o.profile),o.profile.featuredVideo=e.videoSource(r)})},o.$watch("profile",function(i,e){i!=e&&(o.profile=i,r.setProfile(o.profile))}),o.getUserInfo(),o.profileData=JSON.parse(localStorage.userProfile)}}}}}]),drip8.directive("to",[function(){return{restrict:"A",scope:!0,link:function(i,e,t){e.bind("click",function(){window.location=t.to})}}}]),drip8.directive("uiTemplate",[function(){return{restrict:"E",scope:!0,templateUrl:function(i,e){return"/api/template?template="+e.ngTemplate}}}]),drip8.directive("videoDashboard",["$http","Video",function(i,e){return{restrict:"A",scope:!0,link:function(i,t,r){i.videoSrc=e.videoSource(r.videoSource.split("v=")[1])}}}]),drip8.directive("videoLink",["$http","profileService","Video",function(i,e,t){return{restrict:"A",scope:!0,link:function(r,o,n){r.videoSource,$("#videoLink").on("hidden.bs.modal",function(){r.$apply(function(){r.videoSource=""})}),r.exit=function(){$("#videoLink").modal("hide")},r.$on("video-source",function(e,o,n){r.videoSource=o,r.directDrip=t.videoSource(n.link.split("v=")[1]),i.post("/api/drip_each",{drip_id:n.id}).success(function(i){r.comments=i.drip.comments,r.drip=i.drip})}),r.fbShare=function(i){FB.ui({method:"share",href:i,caption:"www.drip8.com"},function(i){})},r.react=function(t){var o=e.setProfile(),n=o.profile_picture.split("/")[3];i.post("/api/create_comment",{comment:{user_id:o.id,drip_id:r.drip.id,dripbucket_id:"",facebook_id:n,body:t}}).success(function(i){var e=i.comment;e.user=o,r.comments.push(e)}),r.dripComment=""}}}}]),drip8.factory("Video",["$sce",function(i){return this.thumbnail=function(e){return i.trustAsResourceUrl("http://img.youtube.com/vi/"+e+"/0.jpg")},this.videoSource=function(e){return i.trustAsResourceUrl("http://www.youtube.com/embed/"+e+"?rel=0&nologo=1&showinfo=0&modestbranding=1&iv_load_policy=3")},this}]);
//# sourceMappingURL=app.min.js.map
