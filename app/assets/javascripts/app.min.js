var drip8=angular.module("Drip8",["angular-flexslider"]);window.fbAsyncInit=function(){FB.init({appId:"719176184895882",status:!0,xfbml:!0,version:"v2.3"})},drip8.directive("auth",[function(){return{restrict:"A",scope:!0,link:function(i,e,t){i.login=function(){window.location="/auth/facebook"}}}}]),drip8.directive("bucket",["$rootScope","$http",function(i,e){return{restrict:"A",scope:!0,link:function(t,o,r){t.profileData={},t.buckets=[],t.newDrip=function(e){i.$broadcast("drip-new",e)},t.getDrip=function(i){e.post("/api/read_drips_by_bucket_and_user",{user_id:t.profileData.id,dripbucket_id:i}).success(function(i){console.log(i)})},t.newBucket=function(i){$("#createDripBoardBox").modal("hide"),e.post("/api/add_bucket",{bucket:{user_id:t.profileData.id,name:i.name,state:i.state}}).success(function(i){window.location.reload()})},t.getAllBucket=function(){e.post("/api/read_all_bucket_by_user",{user_id:t.profileData.id}).success(function(i){t.buckets=i.buckets})},t.$on("profile-data",function(i,e){t.profileData=e,t.getAllBucket()})}}}]),drip8.directive("dripDashboard",["$http","$rootScope",function(i,e){return{restrict:"A",scope:!0,link:function(t,o,r){t.drips=[],i.get("/api/drip_length").success(function(i){for(var e=[],o=i.count-1;o>=i.count-3;o--)e.push(o);var r=n(e);async.parallel(r,function(i,e){t.drips=e})});var n=function(e){var t=[];return e.forEach(function(e){t.push(function(t){i.post("/api/drip_each",{drip_id:e}).success(function(i){t(null,i)})})}),t};t.seeBucket=function(i){console.log("see Bucket"),e.$broadcast("see-bucket",i)}}}}]),drip8.directive("dripList",["$http","Video","$rootScope",function(i,e,t){return{restrict:"A",scope:!0,link:function(o,r,n){var c=n.dripList.split("-");o.drips=[],o.dripListing=function(){i.post("/api/read_drips_by_bucket_and_user",{dripbucket_id:c[0],user_id:c[1]}).success(function(i){o.drips=i.drips})},o.linkUri=function(i,t){var o=i.split("v=")[1],r=o.indexOf("&");return-1!=r&&(o=o.substring(0,r)),"thumb"==t?e.thumbnail(o):e.videoSource(o)},o.showVideo=function(i,e){$("#videoLink").modal("show"),t.$broadcast("video-source",i,e)},o.dripListing(),o.$on("drips-reload",function(){o.dripListing()})}}}]),drip8.directive("dripModalBucket",["$http","$rootScope","Video","profileService",function(i,e,t,o){return{restrict:"A",scope:!0,link:function(r,n,c){console.log("drip-modal-bucket"),e.$on("see-bucket",function(i,e){r.directDrip=t.videoSource(e.drip.link.split("v=")[1]),r.dripBucketDetails=e,r.comments=r.dripBucketDetails.drip.comments;for(var o=0;o<=e.drip.dripbucket.drips.length-1;o++){var n=r.dripBucketDetails.drip.dripbucket.drips[o].link.split("v=")[1];console.log(n),r.dripBucketDetails.drip.dripbucket.drips[o].thumb=t.thumbnail(n),console.log(r.dripBucketDetails.drip.dripbucket.drips[o].thumb),console.log(r.dripBucketDetails.drip.dripbucket.drips[o].link)}console.log(r.dripBucketDetails),r.drip=r.dripBucketDetails.drip}),r.changeVideo=function(i){r.$broadcast("change-video",i)},r.$on("change-video",function(i,e){r.directDrip=t.videoSource(e.link.split("v=")[1]),r.comments=e.comments,r.drip=e,console.log(e)}),r.react=function(e){var t=o.setProfile(),n=t.profile_picture.split("/")[3];console.log(r.dripBucketDetails),console.log(t.profile_picture.split("/")),i.post("/api/create_comment",{comment:{user_id:t.id,drip_id:r.drip.id,dripbucket_id:"",facebook_id:n,body:e}}).success(function(i){var e=i.comment;e.user=t,r.comments.push(e)}),r.dripComment=""}}}}]),drip8.directive("drip",["$http","$rootScope",function(i,e){return{restrict:"A",scope:!0,link:function(t,o,r){t.dripDetails={state:"public"},t.profileData={},t.addDrip=function(){$("#addADrip").modal("hide"),t.dripDetails.user_id=t.profileData.id,i.post("/api/add_drip",{drip:t.dripDetails}).success(function(i){e.$broadcast("drips-reload"),t.dripDetails={state:"public"}})},t.$on("drip-new",function(i,e){t.dripDetails.dripbucket_id=e}),t.$on("profile-data",function(i,e){t.profileData=e})}}}]),drip8.directive("feature",["$http",function(i){return{restrict:"A",scope:!0,link:function(e,t,o){var r=o.feature.split("-");t.bind("click",function(){i.post("/api/new_featured",{user_id:r[0],drip_id:r[1]}).success(function(i){window.location.reload()})})}}}]),drip8.service("profileService",[function(){var i={};return{setProfile:function(e){return e?(i=e,void console.log(i)):i}}}]),drip8.directive("profile",["$http","Video","$rootScope","profileService",function(i,e,t,o){return{restrict:"A",scope:!0,link:function(r,n,c){console.log("profile"),r.profile={},r.getUserInfo=function(){i.get("/api/user").success(function(i){r.profile=i.data,r.trustUrl()})},r.trustUrl=function(){var o="";i.post("/api/video_featured",{user_id:r.profile.id}).success(function(i){if(i.link){o=i.link.split("v=")[1];var n=o.indexOf("&");-1!=n&&(o=o.substring(0,n))}r.profile.featured=i.link,t.$broadcast("profile-data",r.profile),r.profile.featuredVideo=e.videoSource(o)})},r.$watch("profile",function(i,e){i!=e&&(r.profile.newValue,console.log(r.profile),o.setProfile(r.profile))}),r.getUserInfo()}}}]),drip8.directive("to",[function(){return{restrict:"A",scope:!0,link:function(i,e,t){e.bind("click",function(){window.location=t.to})}}}]),drip8.directive("uiTemplate",[function(){return{restrict:"E",scope:!0,templateUrl:function(i,e){return"/api/template?template="+e.ngTemplate}}}]),drip8.directive("videoDashboard",["$http","Video",function(i,e){return{restrict:"A",scope:!0,link:function(i,t,o){i.videoSrc=e.videoSource(o.videoSource.split("v=")[1])}}}]),drip8.directive("videoLink",["$http","profileService",function(i,e){return{restrict:"A",scope:!0,link:function(t,o,r){t.videoSource,$("#videoLink").on("hidden.bs.modal",function(){t.$apply(function(){t.videoSource=""})}),t.$on("video-source",function(e,o,r){t.videoSource=o,i.post("/api/drip_each",{drip_id:r}).success(function(i){console.log(i),t.comments=i.drip.comments,t.drip=i.drip})}),t.react=function(o){var r=e.setProfile(),n=r.profile_picture.split("/")[3];console.log(t.dripBucketDetails),console.log(r.profile_picture.split("/")),i.post("/api/create_comment",{comment:{user_id:r.id,drip_id:t.drip.id,dripbucket_id:"",facebook_id:n,body:o}}).success(function(i){var e=i.comment;e.user=r,t.comments.push(e)}),t.dripComment=""}}}}]),drip8.factory("Video",["$sce",function(i){return this.thumbnail=function(e){return i.trustAsResourceUrl("http://img.youtube.com/vi/"+e+"/0.jpg")},this.videoSource=function(e){return i.trustAsResourceUrl("http://www.youtube.com/embed/"+e+"?rel=0&nologo=1&showinfo=0&modestbranding=1&iv_load_policy=3")},this}]);
//# sourceMappingURL=app.min.js.map
