var drip8=angular.module("Drip8",["angular-flexslider","infinite-scroll"]);window.fbAsyncInit=function(){FB.init({appId:"719176184895882",status:!0,xfbml:!0,version:"v2.3"})},drip8.directive("auth",[function(){return{restrict:"A",scope:!0,link:function(i,e,o){i.login=function(){window.location="/auth/facebook"}}}}]),drip8.directive("bucket",["$rootScope","$http","profileService","dripListService",function(i,e,o,t){return{restrict:"A",scope:!0,link:function(r,n,c){r.profileData={},r.buckets=[],r.newDrip=function(e,o){i.$broadcast("drip-new",e,o)},r.getDrip=function(i){e.post("/api/read_drips_by_bucket_and_user",{user_id:r.profileData.id,dripbucket_id:i}).success(function(i){console.log(i)})},r.description=function(i){return null!=i},r.newBucket=function(i){$("#createDripBoardBox").modal("hide"),e.post("/api/add_bucket",{bucket:{user_id:r.profileData.id,name:i.name,state:i.state}}).success(function(i){window.location.reload()})},r.getAllBucket=function(){e.post("/api/read_all_bucket_by_user",{user_id:r.profileData.id}).success(function(i){r.buckets=i.buckets;var e=o.setProfile();("1"==r.profileData.id||"1"==e.id)&&(r.buckets.splice(0,3),console.log(r.buckets))})},r.rename=function(i,e){};var s=function(i,o){var t=[];return i.forEach(function(i){console.log(i),o="public"==o?i.state:"profile only",t.push(function(t){e.post("/api/update_drip_state",{drip_id:i.id,state:o}).success(function(i){t(null,i)})})}),t};r.setting=function d(i,d,o,n){switch(o){case"drip":e.post("/api/update_drip_state",{drip_id:i.id,state:d}).success(function(i){console.log("New",i),r.$broadcast("drips-reload")});break;case"bucket":console.log(n);var c=t.setDripList(),p=c[n],l=s(p,d);async.parallel(l,function(i,e){console.log(e),r.$broadcast("drips-reload")})}},r.deleteDrip=function(i,e){console.log(i,e)},r.settingDropdown=function(i){var e=o.setProfile();if(r.profileData.id!=e.id)return!1;switch(i){case"who I am":return!1;case"what I do":return!1;case"what I am proud of":return!1;default:return!0}},r.$on("profile-data",function(i,e){r.profileData=JSON.parse(localStorage.userProfile),console.log("profile data below"),console.log(r.profileData),r.getAllBucket()})}}}]),drip8.directive("dripDashboard",["$http","$rootScope",function(i,e){return{restrict:"A",scope:!0,link:function(o,t,r){o.drips=[],o.lastId="dont stop",i.get("/api/drip_length").success(function(i){for(var e=[],t=i.count;t>=i.count-3;t--)e.push(t);var r=n(e);async.parallel(r,function(i,e){for(var t=0;t<e.length;t++)(null==e[t].drip||"public"!=e[t].drip.state||"deleted"==e[t].drip.state)&&(console.log("***************************deleted",e[t].drip),e.splice(t,1)),console.log(e[t].drip);o.drips=e,console.log(e)})}),o.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))};var n=function(e){var o=[];return e.forEach(function(e){console.log(e),o.push(function(o){i.post("/api/drip_each",{drip_id:e}).success(function(i){o(null,i)})})}),o};o.seeBucket=function(i){console.log("see Bucket"),e.$broadcast("see-bucket",i)},o.loadMore=function(){console.log(" ***************  "),console.log(o.drips),console.log(o.drips[o.drips.length-1]);var e=o.drips[o.drips.length-1];if(null!=e){var t=e.drip.id,r=t-1;t>=0&&"stop"!=o.lastId&&(console.log(o.lastId),console.log(t),i.post("/api/drip_each",{drip_id:r}).success(function(e){console.log(e),"deleted"==e.drip.state&&i.post("/api/drip_each",{drip_id:e.drip.id-1}).success(function(i){console.log(i),null!=i.drip&&"public"==i.drip.state&&(o.drips.push(i),console.log("pushed")),0==t&&(console.log("stop na"),o.lastId="stop",console.log(o.lastId))}),null!=e.drip&&"public"==e.drip.state&&(o.drips.push(e),console.log("pushed")),0==t&&(console.log("stop na"),o.lastId="stop",console.log(o.lastId))}))}}}}}]),drip8.service("dripListService",[function(){var i=[];return{setDripList:function(e,o){return o?void(i[e]=o):i}}}]),drip8.directive("dripList",["$http","Video","$rootScope","dripListService",function(i,e,o,t){return{restrict:"A",scope:!0,link:function(r,n,c){var s=c.dripList.split("-");console.log(s[2]),r.drips=[];var d=function(i){var e=[];return i.forEach(function(i){"deleted"!=i.state&&e.push(i)}),e};r.dripListing=function(){i.post("/api/read_drips_by_bucket_and_user",{dripbucket_id:s[0],user_id:s[1]}).success(function(i){r.drips=i.drips,t.setDripList(s[2],r.drips),r.drips=d(r.drips),$("#welcome").modal("hide")})},r.linkUri=function(i,o){var t=i.split("v=")[1],r=t.indexOf("&");return-1!=r&&(t=t.substring(0,r)),"thumb"==o?e.thumbnail(t):e.videoSource(t)},r.showVideo=function(i,e){$("#videoLink").modal("show"),o.$broadcast("video-source",i,e)},r.dripListing(),r.$on("drips-reload",function(){r.dripListing()})}}}]),drip8.directive("dripModalBucket",["$http","$rootScope","Video","profileService",function(i,e,o,t){return{restrict:"A",scope:!0,link:function(r,n,c){console.log("drip-modal-bucket"),e.$on("see-bucket",function(i,e){console.log(e),r.directDrip=o.videoSource(e.drip.link.split("v=")[1]),r.dripBucketDetails=e,r.comments=r.dripBucketDetails.drip.comments;for(var t=0;t<=e.drip.dripbucket.drips.length-1;t++){var n=r.dripBucketDetails.drip.dripbucket.drips[t].link.split("v=")[1];console.log(n),r.dripBucketDetails.drip.dripbucket.drips[t].thumb=o.thumbnail(n),console.log(r.dripBucketDetails.drip.dripbucket.drips[t].thumb),console.log(r.dripBucketDetails.drip.dripbucket.drips[t].link)}console.log(r.dripBucketDetails),r.drip=r.dripBucketDetails.drip}),r.exit=function(){$("#myModal").modal("hide")},r.changeVideo=function(i){r.$broadcast("change-video",i)},r.$on("change-video",function(i,e){r.directDrip=o.videoSource(e.link.split("v=")[1]),r.comments=e.comments,r.drip=e,console.log(e)}),r.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))},r.react=function(e){var o=t.setProfile(),n=o.profile_picture.split("/")[3];console.log(r.dripBucketDetails),console.log(o.profile_picture.split("/")),i.post("/api/create_comment",{comment:{user_id:o.id,drip_id:r.drip.id,dripbucket_id:"",facebook_id:n,body:e}}).success(function(i){var e=i.comment;e.user=o,r.comments.push(e)}),r.dripComment=""}}}}]),drip8.directive("drip",["$http","$rootScope",function(i,e){return{restrict:"A",scope:!0,link:function(o,t,r){o.dripDetails={state:"profile only"},o.profileData={},o.addDrip=function(){$("#addADrip").modal("hide"),o.dripDetails.user_id=o.profileData.id,i.post("/api/add_drip",{drip:o.dripDetails}).success(function(i){e.$broadcast("drips-reload"),o.dripDetails={state:"public"}})},o.$on("drip-new",function(i,e,t){o.dripDetails.dripbucket_id=e,o.bucketName=t,o.dripState=function(){return"who I am"==o.bucketName||"what I do"==o.bucketName||"what I am proud of"==o.bucketName?!1:!0}}),o.$on("profile-data",function(i,e){o.profileData=e})}}}]),drip8.directive("feature",["$http",function(i){return{restrict:"A",scope:!0,link:function(e,o,t){var r=t.feature.split("-");o.bind("click",function(){i.post("/api/new_featured",{user_id:r[0],drip_id:r[1]}).success(function(i){window.location.reload()})})}}}]),drip8.service("profileService",[function(){var i={};return{setProfile:function(e){return e?void(i=e):i}}}]),drip8.directive("profile",["$http","Video","$rootScope","profileService",function(i,e,o,t){return{restrict:"A",scope:!0,compile:function(r,n){return{pre:function(i,e,o){i.count=0,i.profileName=function(e){if(void 0!=e&&(i.count+=1,1==i.count)){var e=e.split(" ");return console.log(i.count),console.log(e),e[0]}}},post:function(r,n,c){r.profile={},r.getUserInfo=function(){i.get("/api/user").success(function(i){r.profile=i.data,r.trustUrl()})},r.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))},r.trustUrl=function(){var t="";i.post("/api/video_featured",{user_id:r.profile.id}).success(function(i){if(i.link){t=i.link.split("v=")[1];var n=t.indexOf("&");-1!=n&&(t=t.substring(0,n))}r.profile.featured=i.link,o.$broadcast("profile-data",r.profile),r.profile.featuredVideo=e.videoSource(t)})},r.$watch("profile",function(i,e){i!=e&&(r.profile=i,console.log("Profile****",r.profile),t.setProfile(r.profile))}),r.getUserInfo(),r.profileData=JSON.parse(localStorage.userProfile),console.log(r.profileData)}}}}}]),drip8.directive("to",[function(){return{restrict:"A",scope:!0,link:function(i,e,o){e.bind("click",function(){window.location=o.to})}}}]),drip8.directive("uiTemplate",[function(){return{restrict:"E",scope:!0,templateUrl:function(i,e){return"/api/template?template="+e.ngTemplate}}}]),drip8.directive("videoDashboard",["$http","Video",function(i,e){return{restrict:"A",scope:!0,link:function(i,o,t){i.videoSrc=e.videoSource(t.videoSource.split("v=")[1])}}}]),drip8.directive("videoLink",["$http","profileService","Video",function(i,e,o){return{restrict:"A",scope:!0,link:function(t,r,n){t.videoSource,$("#videoLink").on("hidden.bs.modal",function(){t.$apply(function(){t.videoSource=""})}),t.exit=function(){$("#videoLink").modal("hide")},t.$on("video-source",function(e,r,n){t.videoSource=r,console.log(n),t.directDrip=o.videoSource(n.link.split("v=")[1]),i.post("/api/drip_each",{drip_id:n.id}).success(function(i){console.log(i),t.comments=i.drip.comments,t.drip=i.drip})}),t.react=function(o){var r=e.setProfile(),n=r.profile_picture.split("/")[3];console.log(t.dripBucketDetails),console.log(r.profile_picture.split("/")),i.post("/api/create_comment",{comment:{user_id:r.id,drip_id:t.drip.id,dripbucket_id:"",facebook_id:n,body:o}}).success(function(i){var e=i.comment;e.user=r,t.comments.push(e)}),t.dripComment=""}}}}]),drip8.factory("Video",["$sce",function(i){return this.thumbnail=function(e){return i.trustAsResourceUrl("http://img.youtube.com/vi/"+e+"/0.jpg")},this.videoSource=function(e){return i.trustAsResourceUrl("http://www.youtube.com/embed/"+e+"?rel=0&nologo=1&showinfo=0&modestbranding=1&iv_load_policy=3")},this}]);
//# sourceMappingURL=app.min.js.map
