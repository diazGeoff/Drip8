var drip8=angular.module("Drip8",["angular-flexslider","infinite-scroll"]);drip8.directive("auth",[function(){return{restrict:"A",scope:!0,link:function(i,t,e){i.login=function(){window.location="/auth/facebook"}}}}]),drip8.directive("bucket",["$rootScope","$http","profileService","dripListService",function(i,t,e,r){return{restrict:"A",scope:!0,link:function(o,n,c){o.profileData={},o.buckets=[],o.newDrip=function(t,e){i.$broadcast("drip-new",t,e)},o.getDrip=function(i){t.post("/api/read_drips_by_bucket_and_user",{user_id:o.profileData.id,dripbucket_id:i}).success(function(i){})},o.description=function(i){return null!=i},o.newBucket=function(i){$("#createDripBoardBox").modal("hide"),t.post("/api/add_bucket",{bucket:{user_id:o.profileData.id,name:i.name,state:i.state}}).success(function(i){window.location.reload()})},o.getAllBucket=function(){t.post("/api/read_all_bucket_by_user",{user_id:o.profileData.id}).success(function(i){o.buckets=i.buckets;var t=e.setProfile();"1"==t.id&&"1"==o.profileData.id&&o.buckets.splice(0,3)})},o.rename=function(i,t){};var s=function(i,e){var r=[];return i.forEach(function(i){e="public"==e?i.state:"profile only",r.push(function(r){t.post("/api/update_drip_state",{drip_id:i.id,state:e}).success(function(i){r(null,i)})})}),r};o.setting=function d(i,d,e,n){switch(e){case"drip":t.post("/api/update_drip_state",{drip_id:i.id,state:d}).success(function(i){o.$broadcast("drips-reload")});break;case"bucket":var c=r.setDripList(),a=c[n],u=s(a,d);async.parallel(u,function(i,t){o.$broadcast("drips-reload")})}},o.deleteDrip=function(i,t){},o.settingDropdown=function(i){var t=e.setProfile();if(o.profileData.id!=t.id)return!1;switch(i){case"who I am":return!1;case"what I do":return!1;case"what I am proud of":return!1;default:return!0}},o.$on("profile-data",function(i,t){o.profileData=JSON.parse(localStorage.userProfile),o.getAllBucket()})}}}]),drip8.directive("ifBucket",["$http",function(i){return{restrict:"A",scope:!0,link:function(i,t,e){console.log(i.$parent.bucketName)}}}]),drip8.directive("dripDashboard",["$http","$rootScope","$window",function(i,t,e){return{restrict:"A",scope:!0,link:function(r,o,n){function c(t,e,o){i.post("/api/drip_each",{drip_id:t}).success(function(i){return i.drip.state!=r.category&&c(t-1,e),null!=i.drip&&i.drip.state==r.category&&e.push(i),0==o&&(r.lastId="stop"),i})}function s(o,n,c){i.post("/api/drip_each",{drip_id:o}).success(function(i){r.category=e.localStorage.getItem("category")||"motivation",i.drip.state!=r.category&&s(o-1,n),null!=i.drip&&i.drip.state==r.category&&(n.push(i.drip.id),n.length<3?s(o-1,n):t.$broadcast("async-yeah",n)),0==c&&(r.lastId="stop")})}r.drips=[],r.ready=!1,r.category=e.localStorage.getItem("category")||"motivation",r.lastId="dont stop",r.asyncTasksArray=[];t.$on("async-yeah",function(i,t){var e=d(t);async.parallel(e,function(i,t){for(var e=0;e<t.length;e++)(null==t[e].drip||t[e].drip.state!=r.category)&&t.splice(e,1);r.drips=t})}),t.$on("on-length-finish",function(i,t){r.index=t,r.drip_length=t,s(r.index,r.asyncTasksArray)}),i.get("/api/drip_length").success(function(i){t.$broadcast("on-length-finish",i.count)}),r.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))},r.fbShare=function(i){FB.ui({method:"share",href:i,caption:"www.drip8.com"},function(i){})};var d=function(t){var e=[];return t.forEach(function(t){e.push(function(e){i.post("/api/drip_each",{drip_id:t}).success(function(i){e(null,i)})})}),e};r.seeBucket=function(i){t.$broadcast("see-bucket",i)},r.loadMore=function(){var t=r.drips[r.drips.length-1];if(null!=t){var o=t.drip.id,n=o-1;o>=0&&"stop"!=r.lastId&&i.post("/api/drip_each",{drip_id:n}).success(function(i){r.category=e.localStorage.getItem("category")||"motivation",i.drip.state!=r.category&&c(i.drip.id-1,r.drips,o),null!=i.drip&&i.drip.state==r.category&&r.drips.push(i),0==o&&(r.lastId="stop")})}}}}}]),drip8.service("dripListService",[function(){var i=[];return{setDripList:function(t,e){return e?void(i[t]=e):i}}}]),drip8.directive("dripList",["$http","Video","$rootScope","dripListService",function(i,t,e,r){return{restrict:"A",scope:!0,link:function(o,n,c){var s=c.dripList.split("-");o.drips=[];var d=function(i){var t=[];return i.forEach(function(i){"deleted"!=i.state&&t.push(i)}),t};o.dripListing=function(){i.post("/api/read_drips_by_bucket_and_user",{dripbucket_id:s[0],user_id:s[1]}).success(function(i){o.drips=i.drips,r.setDripList(s[2],o.drips),o.drips=d(o.drips),$("#welcome").modal("hide")})},o.linkUri=function(i,e){var r=i.split("v=")[1],o=r.indexOf("&");return-1!=o&&(r=r.substring(0,o)),"thumb"==e?t.thumbnail(r):t.videoSource(r)},o.showVideo=function(i,t){$("#videoLink").modal("show"),e.$broadcast("video-source",i,t)},o.dripListing(),o.$on("drips-reload",function(){o.dripListing()})}}}]),drip8.directive("dripModalBucket",["$http","$rootScope","Video","profileService",function(i,t,e,r){return{restrict:"A",scope:!0,link:function(o,n,c){t.$on("see-bucket",function(i,t){o.directDrip=e.videoSource(t.drip.link.split("v=")[1]),o.dripBucketDetails=t,o.comments=o.dripBucketDetails.drip.comments;for(var r=0;r<=t.drip.dripbucket.drips.length-1;r++){var n=o.dripBucketDetails.drip.dripbucket.drips[r].link.split("v=")[1];o.dripBucketDetails.drip.dripbucket.drips[r].thumb=e.thumbnail(n)}o.drip=o.dripBucketDetails.drip}),o.exit=function(){$("#myModal").modal("hide")},o.fbShare=function(i){FB.ui({method:"share",href:i,caption:"www.drip8.com"},function(i){})},o.changeVideo=function(i){o.$broadcast("change-video",i)},o.$on("change-video",function(i,t){o.directDrip=e.videoSource(t.link.split("v=")[1]),o.comments=t.comments,o.drip=t}),o.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))},o.react=function(t){var e=r.setProfile(),n=e.profile_picture.split("/")[3];i.post("/api/create_comment",{comment:{user_id:e.id,drip_id:o.drip.id,dripbucket_id:"",facebook_id:n,body:t}}).success(function(i){var t=i.comment;t.user=e,o.comments.push(t)}),o.dripComment=""}}}}]),drip8.directive("drip",["$http","$rootScope",function(i,t){return{restrict:"A",scope:!0,link:function(e,r,o){e.dripDetails={state:"profile only"},e.profileData={},e.addDrip=function(){$("#addADrip").modal("hide"),e.dripDetails.user_id=e.profileData.id;var r=e.dripDetails.link.slice(0,5);if("https"==r){var o=e.dripDetails.link.replace("https","http");e.dripDetails.link=o}i.post("/api/add_drip",{drip:e.dripDetails}).success(function(i){t.$broadcast("drips-reload"),e.dripDetails={state:"public"}})},e.dripState=function(){return"who I am"==e.bucketName||"what I do"==e.bucketName||"what I am proud of"==e.bucketName?!1:!0},e.$on("drip-new",function(i,t,r){e.dripDetails.dripbucket_id=t,e.bucketName=r,e.dripState=function(){return"who I am"==e.bucketName||"what I do"==e.bucketName||"what I am proud of"==e.bucketName?!1:!0}}),e.$on("profile-data",function(i,t){e.profileData=t})}}}]),drip8.directive("feature",["$http",function(i){return{restrict:"A",scope:!0,link:function(t,e,r){var o=r.feature.split("-");e.bind("click",function(){i.post("/api/new_featured",{user_id:o[0],drip_id:o[1]}).success(function(i){window.location.reload()})})}}}]),drip8.service("profileService",[function(){var i={};return{setProfile:function(t){return t?void(i=t):i}}}]),drip8.directive("profile",["$http","Video","$rootScope","profileService",function(i,t,e,r){return{restrict:"A",scope:!0,compile:function(o,n){return{pre:function(i,t,e){i.count=0,i.profileName=function(t){if(void 0!=t&&(i.count+=1,1==i.count)){var t=t.split(" ");return t[0]}}},post:function(o,n,c){o.setCategory=function(i){localStorage.setItem("category",i),console.log(i)},o.logout=function(){var i=new Date;i.setMonth(i.getMonth()-1),cookievalue=escape(document.myform.customer.value)+";",document.cookie="_Drip8_session="+cookievalue,document.cookie="expires="+i.toUTCString()+";"},$("#welcomeHere").modal("show"),o.profile={},o.getUserInfo=function(){i.get("/api/user").success(function(i){o.profile=i.data,o.trustUrl()})},o.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))},o.trustUrl=function(){var r="";i.post("/api/video_featured",{user_id:o.profile.id}).success(function(i){if(i.link){r=i.link.split("v=")[1];var n=r.indexOf("&");-1!=n&&(r=r.substring(0,n))}o.profile.featured=i.link,e.$broadcast("profile-data",o.profile),o.profile.featuredVideo=t.videoSource(r)})},o.$watch("profile",function(i,t){i!=t&&(o.profile=i,r.setProfile(o.profile))}),o.getUserInfo(),o.profileData=JSON.parse(localStorage.userProfile)}}}}}]),drip8.directive("to",[function(){return{restrict:"A",scope:!0,link:function(i,t,e){t.bind("click",function(){window.location=e.to})}}}]),drip8.directive("uiTemplate",[function(){return{restrict:"E",scope:!0,templateUrl:function(i,t){return"/api/template?template="+t.ngTemplate}}}]),drip8.directive("videoDashboard",["$http","Video",function(i,t){return{restrict:"A",scope:!0,link:function(i,e,r){i.videoSrc=t.videoSource(r.videoSource.split("v=")[1])}}}]),drip8.directive("videoLink",["$http","profileService","Video",function(i,t,e){return{restrict:"A",scope:!0,link:function(r,o,n){r.videoSource,$("#videoLink").on("hidden.bs.modal",function(){r.$apply(function(){r.videoSource=""})}),r.exit=function(){$("#videoLink").modal("hide")},r.$on("video-source",function(t,o,n){r.videoSource=o,r.directDrip=e.videoSource(n.link.split("v=")[1]),i.post("/api/drip_each",{drip_id:n.id}).success(function(i){r.comments=i.drip.comments,r.drip=i.drip})}),r.fbShare=function(i){FB.ui({method:"share",href:i,caption:"www.drip8.com"},function(i){})},r.react=function(e){var o=t.setProfile(),n=o.profile_picture.split("/")[3];i.post("/api/create_comment",{comment:{user_id:o.id,drip_id:r.drip.id,dripbucket_id:"",facebook_id:n,body:e}}).success(function(i){var t=i.comment;t.user=o,r.comments.push(t)}),r.dripComment=""}}}}]),drip8.factory("Video",["$sce",function(i){return this.thumbnail=function(t){return i.trustAsResourceUrl("http://img.youtube.com/vi/"+t+"/0.jpg")},this.videoSource=function(t){return i.trustAsResourceUrl("http://www.youtube.com/embed/"+t+"?rel=0&nologo=1&showinfo=0&modestbranding=1&iv_load_policy=3")},this}]);
//# sourceMappingURL=app.min.js.map
