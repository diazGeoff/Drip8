var drip8=angular.module("Drip8",["angular-flexslider","infinite-scroll"]);window.fbAsyncInit=function(){FB.init({appId:"719176184895882",status:!0,xfbml:!0,version:"v2.3"})},drip8.directive("auth",[function(){return{restrict:"A",scope:!0,link:function(i,e,o){i.login=function(){window.location="/auth/facebook"}}}}]),drip8.directive("bucket",["$rootScope","$http",function(i,e){return{restrict:"A",scope:!0,link:function(o,t,r){o.profileData={},o.buckets=[],console.log(localStorage.userProfile),o.newDrip=function(e){i.$broadcast("drip-new",e)},o.getDrip=function(i){e.post("/api/read_drips_by_bucket_and_user",{user_id:o.profileData.id,dripbucket_id:i}).success(function(i){console.log(i)})},o.newBucket=function(i){$("#createDripBoardBox").modal("hide"),e.post("/api/add_bucket",{bucket:{user_id:o.profileData.id,name:i.name,state:i.state}}).success(function(i){window.location.reload()})},o.getAllBucket=function(){e.post("/api/read_all_bucket_by_user",{user_id:o.profileData.id}).success(function(i){o.buckets=i.buckets})},o.rename=function(i,e){console.log(i,e)},o.setting=function n(i,n,e){console.log(i,n,e)},o.deleteDrip=function(i,e){console.log(i,e)},o.$on("profile-data",function(i,e){o.profileData=JSON.parse(localStorage.userProfile),console.log("profile data below"),console.log(o.profileData),o.getAllBucket()})}}}]),drip8.directive("dripDashboard",["$http","$rootScope",function(i,e){return{restrict:"A",scope:!0,link:function(o,t,r){o.drips=[],o.lastId="dont stop",i.get("/api/drip_length").success(function(i){for(var e=[],t=i.count;t>=i.count-3;t--)e.push(t);var r=n(e);async.parallel(r,function(i,e){for(var t=0;t<e.length;t++)null==e[t].drip&&e.splice(t,1),console.log(e[t].drip);o.drips=e,console.log(e)})}),o.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))};var n=function(e){var o=[];return e.forEach(function(e){console.log(e),o.push(function(o){i.post("/api/drip_each",{drip_id:e}).success(function(i){o(null,i)})})}),o};o.seeBucket=function(i){console.log("see Bucket"),e.$broadcast("see-bucket",i)},o.loadMore=function(){var e=o.drips[o.drips.length-1],t=e.drip.id,r=t-1;t>=0&&"stop"!=o.lastId&&i.post("/api/drip_each",{drip_id:r}).success(function(i){console.log(i),null!=i.drip&&"public"==i.drip.state&&o.drips.push(i),0==t&&(o.lastId="stop")})}}}}]),drip8.directive("dripList",["$http","Video","$rootScope",function(i,e,o){return{restrict:"A",scope:!0,link:function(t,r,n){var c=n.dripList.split("-");t.drips=[],t.dripListing=function(){i.post("/api/read_drips_by_bucket_and_user",{dripbucket_id:c[0],user_id:c[1]}).success(function(i){t.drips=i.drips})},t.linkUri=function(i,o){var t=i.split("v=")[1],r=t.indexOf("&");return-1!=r&&(t=t.substring(0,r)),"thumb"==o?e.thumbnail(t):e.videoSource(t)},t.showVideo=function(i,e){$("#videoLink").modal("show"),o.$broadcast("video-source",i,e)},t.dripListing(),t.$on("drips-reload",function(){t.dripListing()})}}}]),drip8.directive("dripModalBucket",["$http","$rootScope","Video","profileService",function(i,e,o,t){return{restrict:"A",scope:!0,link:function(r,n,c){console.log("drip-modal-bucket"),e.$on("see-bucket",function(i,e){r.directDrip=o.videoSource(e.drip.link.split("v=")[1]),r.dripBucketDetails=e,r.comments=r.dripBucketDetails.drip.comments;for(var t=0;t<=e.drip.dripbucket.drips.length-1;t++){var n=r.dripBucketDetails.drip.dripbucket.drips[t].link.split("v=")[1];console.log(n),r.dripBucketDetails.drip.dripbucket.drips[t].thumb=o.thumbnail(n),console.log(r.dripBucketDetails.drip.dripbucket.drips[t].thumb),console.log(r.dripBucketDetails.drip.dripbucket.drips[t].link)}console.log(r.dripBucketDetails),r.drip=r.dripBucketDetails.drip}),r.changeVideo=function(i){r.$broadcast("change-video",i)},r.$on("change-video",function(i,e){r.directDrip=o.videoSource(e.link.split("v=")[1]),r.comments=e.comments,r.drip=e,console.log(e)}),r.passProfile=function(i){localStorage.setItem("userProfile",JSON.stringify(i))},r.react=function(e){var o=t.setProfile(),n=o.profile_picture.split("/")[3];console.log(r.dripBucketDetails),console.log(o.profile_picture.split("/")),i.post("/api/create_comment",{comment:{user_id:o.id,drip_id:r.drip.id,dripbucket_id:"",facebook_id:n,body:e}}).success(function(i){var e=i.comment;e.user=o,r.comments.push(e)}),r.dripComment=""}}}}]),drip8.directive("drip",["$http","$rootScope",function(i,e){return{restrict:"A",scope:!0,link:function(o,t,r){o.dripDetails={state:"public"},o.profileData={},o.addDrip=function(){$("#addADrip").modal("hide"),o.dripDetails.user_id=o.profileData.id,i.post("/api/add_drip",{drip:o.dripDetails}).success(function(i){e.$broadcast("drips-reload"),o.dripDetails={state:"public"}})},o.$on("drip-new",function(i,e){o.dripDetails.dripbucket_id=e}),o.$on("profile-data",function(i,e){o.profileData=e})}}}]),drip8.directive("feature",["$http",function(i){return{restrict:"A",scope:!0,link:function(e,o,t){var r=t.feature.split("-");o.bind("click",function(){i.post("/api/new_featured",{user_id:r[0],drip_id:r[1]}).success(function(i){window.location.reload()})})}}}]),drip8.service("profileService",[function(){var i={};return{setProfile:function(e){return e?(i=e,void console.log(i)):i}}}]),drip8.directive("profile",["$http","Video","$rootScope","profileService",function(i,e,o,t){return{restrict:"A",scope:!0,link:function(r,n,c){console.log("profile"),r.profile={},r.getUserInfo=function(){i.get("/api/user").success(function(i){r.profile=i.data,r.trustUrl()})},r.trustUrl=function(){var t="";i.post("/api/video_featured",{user_id:r.profile.id}).success(function(i){if(i.link){t=i.link.split("v=")[1];var n=t.indexOf("&");-1!=n&&(t=t.substring(0,n))}r.profile.featured=i.link,o.$broadcast("profile-data",r.profile),r.profile.featuredVideo=e.videoSource(t)})},r.$watch("profile",function(i,e){i!=e&&(r.profile.newValue,console.log(r.profile),t.setProfile(r.profile))}),r.getUserInfo()}}}]),drip8.directive("to",[function(){return{restrict:"A",scope:!0,link:function(i,e,o){e.bind("click",function(){window.location=o.to})}}}]),drip8.directive("uiTemplate",[function(){return{restrict:"E",scope:!0,templateUrl:function(i,e){return"/api/template?template="+e.ngTemplate}}}]),drip8.directive("videoDashboard",["$http","Video",function(i,e){return{restrict:"A",scope:!0,link:function(i,o,t){i.videoSrc=e.videoSource(t.videoSource.split("v=")[1])}}}]),drip8.directive("videoLink",["$http","profileService",function(i,e){return{restrict:"A",scope:!0,link:function(o,t,r){o.videoSource,$("#videoLink").on("hidden.bs.modal",function(){o.$apply(function(){o.videoSource=""})}),o.$on("video-source",function(e,t,r){o.videoSource=t,i.post("/api/drip_each",{drip_id:r}).success(function(i){console.log(i),o.comments=i.drip.comments,o.drip=i.drip})}),o.react=function(t){var r=e.setProfile(),n=r.profile_picture.split("/")[3];console.log(o.dripBucketDetails),console.log(r.profile_picture.split("/")),i.post("/api/create_comment",{comment:{user_id:r.id,drip_id:o.drip.id,dripbucket_id:"",facebook_id:n,body:t}}).success(function(i){var e=i.comment;e.user=r,o.comments.push(e)}),o.dripComment=""}}}}]),drip8.factory("Video",["$sce",function(i){return this.thumbnail=function(e){return i.trustAsResourceUrl("http://img.youtube.com/vi/"+e+"/0.jpg")},this.videoSource=function(e){return i.trustAsResourceUrl("http://www.youtube.com/embed/"+e+"?rel=0&nologo=1&showinfo=0&modestbranding=1&iv_load_policy=3")},this}]);
//# sourceMappingURL=app.min.js.map
